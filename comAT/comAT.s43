;----------------------------------------------------------------------------------------------
#include "msp430g2553.h"
#include "../util/constants.h"
;----------------------------------------------------------------------------------------------
        NAME   COMMAT
        PUBLIC TESTE_RADIO,VERSAO_RADIO
        RSEG   CODE           
;----------------------------------------------------------------------------------------------
TESTE_RADIO
;----------------------------------------------------------------------------------------------
        push      DATA_MSG
        push      COUNT
        mov.w     #AT_OK,DATA_MSG
        mov.b     #4,COUNT        
RUN1:   tst       COUNT
        jeq       FINAL_TESTE_RADIO
        dec       COUNT
        call      #SEND_COMMAND
        jmp       RUN1  
FINAL_TESTE_RADIO:        
        pop       COUNT
        pop       DATA_MSG
        ret
;----------------------------------------------------------------------------------------------
;----------------------------------------------------------------------------------------------
VERSAO_RADIO
;----------------------------------------------------------------------------------------------
        push      R4
        mov.w     #AT_VERSAO,R4
        call      #SEND_COMMAND
        pop       R4
        ret 
;----------------------------------------------------------------------------------------------
;----------------------------------------------------------------------------------------------
SEND_COMMAND
;----------------------------------------------------------------------------------------------
        //bit.b       #UCBUSY,&UCA0STAT 
        //jnz         TX_SEND_BAUD_AT_BUSY                    
        //mov.b       @DATA_MSG+,UCA0TXBUF
        //bis.b       #UCA0TXIFG,&IFG2 ; LIBERA A FLAG PARA COMUNICAÇÃO   
        mov.b       @DATA_MSG+,R8 ; EM TESTE
        ret
;----------------------------------------------------------------------------------------------
;----------------------------------------------------------------------------------------------                   
; ENVIA UM COMANDO AT PARA TESTAR O RADIO
AT_OK      DB          0x41u,0x54u,0x0Du,0x0Au;AT\r\n
; ENVIA UM COMANDO PARA VERIFICAR A VERSAO DO HARDWARE
AT_VERSAO  DB          0x41u,0x54u,0x2Bu,0x56u,0x45u,0x52u,0x53u,0x49u,0x4Fu,0x4Eu,0x0Du,0x0A;AT+VERSION\r\n
;----------------------------------------------------------------------------------------------
;----------------------------------------------------------------------------------------------
        END  
;----------------------------------------------------------------------------------------------